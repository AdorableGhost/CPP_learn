# 理论知识

## 网络分层

### OSI 7层参考模型

- 简介

	- osi, ISO于1981年制定的“开放系统互联参考模型”
	- OSI

		- Open Systems Interconnection Reference Model
		- 开放系统互联参考模型

	- ISO

		- International Organization for Standardization
		- 国际标准化组织

			- ISO搜一下官网就出来了

- 模型理解

	- 这块知识主要参考给大家推荐的书：6页

		- windows网络编程

	- 发送方是打包（封包）的过程自上而下
	- 接收方是解包（拆包）的过程自下而上

- 模型（固定顺序）

	- 应用层

		- 为程序猿提供编码调用的API接口
		- 协议

			- HTTP，HTTPS，FTP，SMTP

	- 表示层

		- 双方通信数据的排布规则

			- 比如数据加密解密，压缩解压
			- 数据的语法表示问题

		- 协议

			- 没有协议
			- 规则是通信双方定，程序猿编码

	- 会话层

		- 建立、管理和终止表示层实体之间的通信会话

			- 删除，存储，管理客户端的socket

		- 协议

			- 开发人员自己定

				- 确定什么情况删除客户端

	- 传输层

		- 讲我们的代码包上一层tcp的包头

			- 即指定了该数据包的发送方式

		- 协议

			- TCP，UDP

	- 网络层

		- 给数据包绑上目标地址
		- 协议

			- IP(4,6)

	- 数据链路层

		- 将软件层面打包好的数据，变成硬件层面可发送的数据
		- 比如

			- 将数据切成很多小段发送

				- 帧
				- 匹配当前的带宽

			- 平衡通信双方的通信质量
			- 双方通信之前的信息交换，比如链接，本地资源准备好

		- 协议

			- 网络适配器

				- 网卡
				- 一般网卡都是兼 物理层

			- PPP 点对点通信协议

	- 物理层

		- 硬件设备

			- 设备标准

				- 接口，排线，排列，尺寸，固定....

			- 设备/协议

				- 双绞线

					- 常见的网线

						- 水晶头排线

							- 568A标准:白绿，绿，白橙，蓝，白蓝，橙，白棕，棕
568B标准:白橙，橙，白绿，蓝，白蓝，绿，白棕，棕
							- 交叉  平行直通

					- 按带宽分

						- CAT1  一类线

							- 750KHZ

						- CAT2  二类线

							- 4M/s

						- CAT3  三类线

							- 10M/s

						- CAT4  四类线

							- 16m/s

						- CAT5  五类线

							- 100m/s

						- CAT5e  超五类线

							- 1000M/s

						- CAT6  六类线

							- 高于1G/s

						- CAT6A  超六类或6A

							- 10G/s

						- CAT7  七类线

							- 10G/s

					- 经历

						- 升网速

							- 全套设备都要支持

				- 调制解调器

					- modem

						- 猫

							- 墙上的电线直接连的这个

						- 将电线上的模拟信号转换成计算机认识的数字信号

				- 光导纤维
				- 同轴电缆
				- ......

		- 功能

			- 传输数据的物理通路
			- 过程

				- 激活物理链接

					- 建立设备之间通路

						- 网线
						- 路由器
						- 交换机

				- 传输数据

					- 保证数据正确通过
					- 提供足够的带宽

						- 一定时间内可以传输的数据量

							- bit/s

				- 终止物理链接

					- 断开链接

### TCP/IP  4层模型

- 应用层

	- 应用
	- 表示
	- 会话

- 传输层
- 网络层
- 数据链路层

	- 逻辑链路层

		- 包含物理层

	- 网卡

## TCP协议头

### 也就是在传输层，这个会包到咱们数据的头部

### 图

- 20字节

	- 160位

- 源端口号
- 目标端口号
- 发送序列号

	- 数据段首字节编号

		- 比如一次发送500字节（头+数据），第一个字节编号，可能是5000，那么这一段最后一个字节编号就是5499

	- seq

- 接收时候的确认序列号

	- 接收方告诉咱们的，我下一次接收的数据的编号
	- 如果咱们的500个数据被完整收到，那么这里就是5500
	- 如果该段数据没有被完整收到，丢帧了，那么则是5000
	- ack

- 偏移值

	- 4位二级制数，最大15，单位4字节，即最大偏移60字节
	- 正常情况下20字节

		- 偏移值就是5

			- 0101

- 保留

	- 暂时没定义意义

		- 4

- 2字节

	- tcp版本支持ecn的这两个有效，显式拥塞通告

		- 即平衡双方流量用的

	- ECE

		- 发送端设置

			- 1

				- 表示请发送端降低数据量，我这边带不如你的宽

	- CWR

		- 接收方设置

			- 1

				- 好的我收到了你的降低请求，我调整了窗口大小

- URG

	- 发送端设置，表示我发送的这组数据你要立刻处理，别等后续包
	- 紧急指针

		- 目前很少被使用了

- ACK

	- 确认接收到了TCP数据包

- PSH

	- 发送端设置，表示我发送的这段包没了，你那边把收到的组合吧

- RST

	- 网络重启

- SYN

	- 虚拟电路接通

		- 咱俩建立通信路的意思

	- 发起链接

- FIN

	- 结束链接，正常下线

		- 释放连接

- 窗口大小

	- 表示我最大一次能接收的数据，受限于自己的带宽
	- ECE 会 配合使用

- 校验和

	- 整个包的字节数

		- 接收端也会验证此

- 紧急指针

	- 它是一个偏移量，和序号字段中的值相加表示紧急数据最后一个字节的序号
	- 该段数据紧急处理

- 可选项

	- 自定义的关心的数据：时间点等等

## tcp/ip网络传输过程

### 链接建立过程

- 三次握手

### 数据收发过程

### 链接断开过程

- 四次挥手

## TCP/IP特点

### 全双工

- 可以同时发送数据和接收数据。这就意味着数据流在一个方向上的传输是独立于另一个方向的传输的

	- tcp就是全双工

- 半双工

	- 发的时候不能接，接的时候不能发

### 面向链接的，可靠的，基于字节流的传输层协议

- 链接

	- connect  accept

		- 三次握手，四次挥手

- 可靠

	- 对发送的每个字节进行编号，校验和

		- 三次握手保证了开始通信成功
		- 接收方验证
		- 如果数据丢失，那么接收确认ack就是上次的编号
		- 接收方再次返回该段首顺序号，发送方就重发这段
		- 四次挥手保证最后接收成功

- 字节流

	- 按字节操作
	- 河流特点

		- 将数据包组合或者剪碎，以适合当前带宽

			- 渠道与水量合适，才能达到最佳效果

		- 平衡两侧带宽

			- 入水口和出水口的通过量要一样了，不然就溢出了

		- 可以缓存，调整合并为有序再传到应用层

			- 小水洼，一边进水，水洼里混合，然后另一边出去

- 传输层

	- 因为处于网络分层中的传输层，控制传输格式

*XMind - Trial Version*